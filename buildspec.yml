---
version: '0.1'

environment_variables:
  plaintext:
    AWS_DEFAULT_REGION: 'us-east-2'
    HUGO_VERSION: '0.56.3'
    HUGO_SHA256: >-
      c062d7cb73945c70cde00f3f858fe2640a82c248dae328f2536dab36d5f6e896

phases:
  install:
    commands:
      - 'wget https://github.com/gohugoio/hugo/releases/download/v${HUGO_VERSION}/hugo_${HUGO_VERSION}_Linux-64bit.deb'
      - 'echo "${HUGO_SHA256}  hugo_${HUGO_VERSION}_Linux-64bit.deb" | sha256sum -c -'
      - 'sudo dpkg -i hugo_${HUGO_VERSION}_Linux-64bit.deb'
    finally:
      - 'hugo version'
  build:
    commands:
      - 'git submodule init'
      - 'git submodule update --recursive'
      - 'hugo --minify'
  post_build:
    commands:
      - 'aws s3 sync --delete public s3://twmartin.codes'
